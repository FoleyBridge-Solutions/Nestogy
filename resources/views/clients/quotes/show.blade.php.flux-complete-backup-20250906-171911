@extends('layouts.app')

@section('title', 'Quote Details')

@section('content')
<div class="w-full px-6">
    <div class="flex flex-wrap -mx-4">
        <div class="flex-1 px-6-12">
            <div class="flex justify-between items-center mb-6">
                <h1 class="h3 mb-0">Quote Details</h1>
                <div class="px-6 py-2 font-medium rounded-md transition-colors-group">
                    @if(in_array($quote->status, ['draft', 'pending']))
                        <a href="{{ route('clients.quotes.standalone.edit', $quote) }}" class="inline-flex items-center px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i class="fas fa-edit mr-2"></i>Edit Quote
                        </a>
                        <button type="button" class="inline-flex items-center px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" onclick="sendQuote({{ $quote->id }})">
                            <i class="fas fa-paper-plane mr-2"></i>Send Quote
                        </button>
                    @endif
                    @if($quote->isAccepted())
                        <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-info" onclick="convertQuote({{ $quote->id }})">
                            <i class="fas fa-file-invoice mr-2"></i>Convert to Invoice
                        </button>
                    @endif
                    <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary" onclick="duplicateQuote({{ $quote->id }})">
                        <i class="fas fa-copy mr-2"></i>Duplicate
                    </button>
                    <a href="{{ route('clients.quotes.standalone.index') }}" class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Quotes
                    </a>
                    <button type="button" 
                            class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-danger" 
                            onclick="deleteQuote({{ $quote->id }})">
                        <i class="fas fa-trash mr-2"></i>Delete
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap -mx-4">
                <div class="flex-1 px-6-lg-8">
                    <!-- Main Quote Details -->
                    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="px-6 py-6 border-b border-gray-200 bg-gray-50">
                            <div class="flex justify-between items-center">
                                <h5 class="bg-white rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-file-alt mr-2"></i>{{ $quote->quote_number }}
                                </h5>
                                <div class="flex gap-2">
                                    @switch($quote->status)
                                        @case('draft')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600">Draft</span>
                                            @break
                                        @case('pending')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning">Pending Approval</span>
                                            @break
                                        @case('sent')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600">Sent to Client</span>
                                            @break
                                        @case('viewed')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-info">Viewed by Client</span>
                                            @break
                                        @case('accepted')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success">Accepted</span>
                                            @break
                                        @case('declined')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger">Declined</span>
                                            @break
                                        @case('expired')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-900">Expired</span>
                                            @break
                                        @case('converted')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success">Converted</span>
                                            @break
                                        @case('cancelled')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600">Cancelled</span>
                                            @break
                                    @endswitch

                                    @if($quote->conversion_probability > 0)
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium @if($quote->conversion_probability >= 75) bg-success @elseif($quote->conversion_probability >= 50) bg-info @elseif($quote->conversion_probability >= 25) bg-warning @else bg-danger @endif">
                                            {{ $quote->conversion_probability }}% Conversion
                                        </span>
                                    @endif
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-wrap -mx-4">
                                <div class="md:w-1/2 px-6">
                                    <h6 class="text-gray-600">Quote Title</h6>
                                    <p class="mb-6 font-bold">{{ $quote->title }}</p>

                                    <h6 class="text-gray-600">Client</h6>
                                    <p class="mb-6">
                                        <a href="{{ route('clients.show', $quote->client) }}" class="text-decoration-none">
                                            {{ $quote->client->display_name }}
                                        </a>
                                    </p>

                                    @if($quote->description)
                                        <h6 class="text-gray-600 dark:text-gray-400">Description</h6>
                                        <div class="mb-6">
                                            {!! nl2br(e($quote->description)) !!}
                                        </div>
                                    @endif
                                </div>

                                <div class="md:w-1/2 px-6">
                                    <h6 class="text-gray-600 dark:text-gray-400">Amount Details</h6>
                                    <div class="mb-6">
                                        <div class="flex justify-between">
                                            <span>Subtotal:</span>
                                            <span class="font-bold">${{ number_format($quote->items->sum('subtotal'), 2) }}</span>
                                        </div>
                                        @if($quote->discount_amount > 0)
                                            <div class="flex justify-between text-yellow-600 dark:text-yellow-400">
                                                <span>Discount:</span>
                                                <span>-{{ $quote->formatted_discount_amount }}</span>
                                            </div>
                                        @endif
                                        
                                        {{-- Tax Breakdown --}}
                                        @php
                                            $taxBreakdown = collect();
                                            foreach($quote->items as $item) {
                                                if($item->tax_breakdown) {
                                                    foreach($item->tax_breakdown as $tax) {
                                                        $taxName = $tax['tax_name'] ?? 'Tax';
                                                        if(!$taxBreakdown->has($taxName)) {
                                                            $taxBreakdown[$taxName] = [
                                                                'name' => $taxName,
                                                                'type' => $tax['tax_type'] ?? '',
                                                                'authority' => $tax['authority'] ?? '',
                                                                'amount' => 0
                                                            ];
                                                        }
                                                        $taxBreakdown[$taxName]['amount'] += $tax['tax_amount'] ?? 0;
                                                    }
                                                }
                                            }
                                            $totalTax = $quote->items->sum('tax');
                                        @endphp
                                        
                                        @if($taxBreakdown->count() > 0)
                                            @foreach($taxBreakdown as $tax)
                                                <div class="flex justify-between small">
                                                    <span class="text-gray-600 dark:text-gray-400">
                                                        {{ $tax['name'] }}
                                                        @if($tax['type'] === 'regulatory')
                                                            <i class="fas fa-info-circle" 
                                                               title="Regulatory Fee: {{ $tax['authority'] }}" 
                                                               x-data x-tooltip></i>
                                                        @endif
                                                    </span>
                                                    <span class="text-gray-600 dark:text-gray-400">${{ number_format($tax['amount'], 2) }}</span>
                                                </div>
                                            @endforeach
                                            <div class="flex justify-between border-t pt-1">
                                                <span>Total Tax:</span>
                                                <span class="font-bold">${{ number_format($totalTax, 2) }}</span>
                                            </div>
                                        @elseif($totalTax > 0)
                                            <div class="flex justify-between">
                                                <span>Tax:</span>
                                                <span class="font-bold">${{ number_format($totalTax, 2) }}</span>
                                            </div>
                                        @endif
                                        
                                        <hr class="my-2">
                                        <div class="flex justify-between">
                                            <span class="font-bold">Total:</span>
                                            <span class="font-bold text-blue-600 fs-5">{{ $quote->formatted_amount }}</span>
                                        </div>
                                    </div>

                                    <h6 class="text-gray-600 dark:text-gray-400">Dates</h6>
                                    <div class="mb-6">
                                        @if($quote->issued_date)
                                            <div class="flex justify-between mb-1">
                                                <span>Issued:</span>
                                                <span>{{ $quote->issued_date->format('M j, Y') }}</span>
                                            </div>
                                        @endif
                                        @if($quote->valid_until)
                                            <div class="flex justify-between mb-1">
                                                <span>Valid Until:</span>
                                                <span>{{ $quote->valid_until->format('M j, Y') }}</span>
                                            </div>
                                            @if($quote->days_until_expiry !== null)
                                                <div class="mt-2">
                                                    @if($quote->days_until_expiry < 0)
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger">Expired {{ abs($quote->days_until_expiry) }} days ago</span>
                                                    @elseif($quote->days_until_expiry == 0)
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning">Expires Today</span>
                                                    @elseif($quote->days_until_expiry <= 7)
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-info">{{ $quote->days_until_expiry }} days left</span>
                                                    @else
                                                        <span class="text-gray-600 dark:text-gray-400">{{ $quote->days_until_expiry }} days left</span>
                                                    @endif
                                                </div>
                                            @endif
                                        @endif
                                        @if($quote->follow_up_date)
                                            <div class="flex justify-between mb-1">
                                                <span>Follow-up:</span>
                                                <span>{{ $quote->follow_up_date->format('M j, Y') }}</span>
                                            </div>
                                            @if($quote->needsFollowUp())
                                                <div class="mt-2">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning">Follow-up Due</span>
                                                </div>
                                            @endif
                                        @endif
                                    </div>
                                </div>
                            </div>

                            @if($quote->line_items && count($quote->line_items) > 0)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Line Items</h6>
                                <div class="min-w-full divide-y divide-gray-200-responsive mb-6">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 min-w-full divide-y divide-gray-200-sm">
                                        <thead class="min-w-full divide-y divide-gray-200 dark:divide-gray-700-light">
                                            <tr>
                                                <th>Description</th>
                                                <th class="text-end">Quantity</th>
                                                <th class="text-end">Unit Price</th>
                                                <th class="text-end">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach($quote->line_items as $item)
                                                <tr>
                                                    <td>{{ $item['description'] }}</td>
                                                    <td class="text-end">{{ $item['quantity'] ?? 1 }}</td>
                                                    <td class="text-end">{{ $quote->getCurrencySymbol() }}{{ number_format($item['unit_price'] ?? 0, 2) }}</td>
                                                    <td class="text-end font-bold">{{ $quote->getCurrencySymbol() }}{{ number_format(($item['quantity'] ?? 1) * ($item['unit_price'] ?? 0), 2) }}</td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>
                            @endif

                            @if($quote->project_scope)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Project Scope</h6>
                                <div class="mb-6 p-6 bg-gray-100 rounded">
                                    {!! nl2br(e($quote->project_scope)) !!}
                                </div>
                            @endif

                            @if($quote->delivery_timeframe)
                                <h6 class="text-gray-600 dark:text-gray-400">Delivery Timeframe</h6>
                                <p class="mb-6">{{ $quote->delivery_timeframe }}</p>
                            @endif

                            @if($quote->payment_terms)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Payment Terms</h6>
                                <div class="mb-6">
                                    {!! nl2br(e($quote->payment_terms)) !!}
                                </div>
                            @endif

                            @if($quote->terms_conditions)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Terms & Conditions</h6>
                                <div class="bg-gray-100 p-6 rounded">
                                    {!! nl2br(e($quote->terms_conditions)) !!}
                                </div>
                            @endif

                            @if($quote->notes)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Internal Notes</h6>
                                <div class="px-6 py-6 rounded bg-cyan-100 border border-cyan-400 text-cyan-700">
                                    <i class="fas fa-sticky-note mr-2"></i>
                                    {!! nl2br(e($quote->notes)) !!}
                                </div>
                            @endif
                        </div>
                    </div>

                    <!-- Signature Section -->
                    @if($quote->client_signature)
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                            <div class="px-6 py-6 border-b border-gray-200 bg-gray-50">
                                <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-signature mr-2"></i>Client Signature
                                </h5>
                            </div>
                            <div class="p-6">
                                <div class="flex flex-wrap -mx-4">
                                    <div class="flex-1 px-6-md-8">
                                        <div class="border p-6 rounded bg-light">
                                            <img src="{{ $quote->client_signature }}" alt="Client Signature" class="img-fluid" style="max-height: 150px;">
                                        </div>
                                    </div>
                                    <div class="flex-1 px-6-md-4">
                                        <div class="small text-gray-600 dark:text-gray-400">
                                            <div class="mb-2">
                                                <strong>Signed on:</strong><br>
                                                {{ $quote->signature_date->format('M j, Y g:i A') }}
                                            </div>
                                            @if($quote->signature_ip)
                                                <div>
                                                    <strong>IP Address:</strong><br>
                                                    {{ $quote->signature_ip }}
                                                </div>
                                            @endif
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    @endif
                </div>

                <div class="flex-1 px-6-lg-4">
                    <!-- Quote Status -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                            <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                <i class="fas fa-info-circle mr-2"></i>Quote Information
                            </h5>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <div class="small text-gray-600 dark:text-gray-400">
                                <div class="flex justify-between mb-2">
                                    <span>Quote Number:</span>
                                    <span class="font-bold">{{ $quote->quote_number }}</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>Currency:</span>
                                    <span>{{ $quote->currency }}</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>Created:</span>
                                    <span>{{ $quote->created_at->format('M j, Y') }}</span>
                                </div>
                                @if($quote->creator)
                                    <div class="flex justify-between mb-2">
                                        <span>Created by:</span>
                                        <span>{{ $quote->creator->name }}</span>
                                    </div>
                                @endif
                                @if($quote->sent_at)
                                    <div class="flex justify-between mb-2">
                                        <span>Sent:</span>
                                        <span>{{ $quote->sent_at->format('M j, Y g:i A') }}</span>
                                    </div>
                                @endif
                                @if($quote->viewed_at)
                                    <div class="flex justify-between mb-2">
                                        <span>Viewed:</span>
                                        <span>{{ $quote->viewed_at->format('M j, Y g:i A') }}</span>
                                    </div>
                                @endif
                                @if($quote->accepted_date)
                                    <div class="flex justify-between mb-2">
                                        <span>Accepted:</span>
                                        <span>{{ $quote->accepted_date->format('M j, Y') }}</span>
                                    </div>
                                @endif
                                @if($quote->declined_date)
                                    <div class="flex justify-between">
                                        <span>Declined:</span>
                                        <span>{{ $quote->declined_date->format('M j, Y') }}</span>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                            <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                <i class="fas fa-bolt mr-2"></i>Quick Actions
                            </h5>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <div class="grid gap-2">
                                @if(in_array($quote->status, ['sent', 'viewed']))
                                    <button class="inline-flex items-center px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="acceptQuote({{ $quote->id }})">
                                        <i class="fas fa-check mr-2"></i>Mark as Accepted
                                    </button>
                                    
                                    <button class="btn bg-yellow-500 text-white hover:bg-yellow-600 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="declineQuote({{ $quote->id }})">
                                        <i class="fas fa-times mr-2"></i>Mark as Declined
                                    </button>
                                @endif

                                @if($quote->isAccepted() && !$quote->isConverted())
                                    <button class="btn bg-cyan-600 text-white hover:bg-cyan-700 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="convertQuote({{ $quote->id }})">
                                        <i class="fas fa-file-invoice mr-2"></i>Convert to Invoice
                                    </button>
                                @endif

                                <hr class="my-2">
                                
                                <a href="{{ route('clients.quotes.standalone.create', ['client_id' => $quote->client_id]) }}" 
                                   class="btn btn-outline-info px-6 py-2 font-medium rounded-md transition-colors-sm">
                                    <i class="fas fa-plus mr-2"></i>New Quote for Client
                                </a>
                                
                                <button class="btn border border-gray-600 text-gray-600 hover:bg-gray-50 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="duplicateQuote({{ $quote->id }})">
                                    <i class="fas fa-copy mr-2"></i>Duplicate Quote
                                </button>
                                
                                <a href="{{ route('clients.show', $quote->client) }}" 
                                   class="btn border border-gray-600 text-gray-600 hover:bg-gray-50 px-6 py-2 font-medium rounded-md transition-colors-sm">
                                    <i class="fas fa-user mr-2"></i>View Client
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Conversion Details -->
                    @if($quote->invoice)
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                                <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-file-invoice mr-2"></i>Converted Invoice
                                </h5>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                                <p class="mb-2">
                                    This quote was converted to invoice:
                                </p>
                                <a href="{{ route('clients.invoices.show', $quote->invoice) }}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 px-6 py-2 font-medium rounded-md transition-colors-sm">
                                    <i class="fas fa-eye mr-2"></i>View Invoice {{ $quote->invoice->invoice_number }}
                                </a>
                                <div class="small text-gray-600 dark:text-gray-400 mt-2">
                                    Converted on: {{ $quote->converted_date->format('M j, Y') }}
                                </div>
                            </div>
                        </div>
                    @endif

                    <!-- Win/Loss Reason -->
                    @if($quote->win_loss_reason && ($quote->isDeclined() || $quote->isConverted()))
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                                <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-comment mr-2"></i>{{ $quote->isConverted() ? 'Win' : 'Loss' }} Reason
                                </h5>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                                <p class="small text-gray-600 dark:text-gray-400 mb-0">
                                    {{ $quote->win_loss_reason }}
                                </p>
                            </div>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Delete Quote Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="deleteQuoteModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Delete Quote</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Are you sure you want to delete this quote? This action cannot be undone.
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="inline-flex items-center px-6 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" @click="$dispatch('close-modal')">Cancel</button>
                <form id="deleteQuoteForm" method="POST" class="inline">
                    @csrf
                    @method('DELETE')
                    <button type="submit" class="inline-flex items-center px-6 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Delete Quote</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Send Quote Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="sendQuoteModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Send Quote</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Send this quote to the client?
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="inline-flex items-center px-6 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" @click="$dispatch('close-modal')">Cancel</button>
                <form id="sendQuoteForm" method="POST" class="inline">
                    @csrf
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-primary">Send Quote</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Convert Quote Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="convertQuoteModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Convert to Invoice</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Convert this quote to an invoice? This will create a new invoice with the quote details.
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                <form id="convertQuoteForm" method="POST" class="inline">
                    @csrf
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-success">Convert to Invoice</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Accept Quote Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="acceptQuoteModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Accept Quote</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Mark this quote as accepted by the client?
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                <form id="acceptQuoteForm" method="POST" class="inline">
                    @csrf
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-success">Accept Quote</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Decline Quote Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="declineQuoteModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Decline Quote</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <form id="declineQuoteForm" method="POST">
                @csrf
                <div class="fixed inset-0 z-50 overflow-y-auto-body">
                    <p>Mark this quote as declined by the client?</p>
                    <div class="mb-6">
                        <label for="declineReason" class="block text-sm font-medium text-gray-700 mb-1">Reason (Optional)</label>
                        <textarea name="reason" id="declineReason" class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" rows="3" placeholder="Reason for declining..."></textarea>
                    </div>
                </div>
                <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                    <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-warning">Decline Quote</button>
                </div>
            </form>
        </div>
    </div>
</div>
@endsection

@push('scripts')
<script>
function deleteQuote(quoteId) {
    const form = document.getElementById('deleteQuoteForm');
    form.action = '/clients/quotes/' + quoteId;
    
    const modal = new bootstrap.Modal(document.getElementById('deleteQuoteModal'));
    modal.show();
}

function sendQuote(quoteId) {
    const form = document.getElementById('sendQuoteForm');
    form.action = '/clients/quotes/' + quoteId + '/send';
    
    const modal = new bootstrap.Modal(document.getElementById('sendQuoteModal'));
    modal.show();
}

function convertQuote(quoteId) {
    const form = document.getElementById('convertQuoteForm');
    form.action = '/clients/quotes/' + quoteId + '/convert';
    
    const modal = new bootstrap.Modal(document.getElementById('convertQuoteModal'));
    modal.show();
}

function acceptQuote(quoteId) {
    const form = document.getElementById('acceptQuoteForm');
    form.action = '/clients/quotes/' + quoteId + '/accept';
    
    const modal = new bootstrap.Modal(document.getElementById('acceptQuoteModal'));
    modal.show();
}

function declineQuote(quoteId) {
    const form = document.getElementById('declineQuoteForm');
    form.action = '/clients/quotes/' + quoteId + '/decline';
    
    const modal = new bootstrap.Modal(document.getElementById('declineQuoteModal'));
    modal.show();
}

function duplicateQuote(quoteId) {
    if (confirm('Create a duplicate of this quote?')) {
        window.location.href = '/clients/quotes/' + quoteId + '/duplicate';
    }
}
</script>
@endpush