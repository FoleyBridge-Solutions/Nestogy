@extends('layouts.app')

@section('title', 'Trip Details')

@section('content')
<div class="w-full px-6">
    <div class="flex flex-wrap -mx-4">
        <div class="flex-1 px-6-12">
            <div class="flex justify-between items-center mb-6">
                <h1 class="h3 mb-0">Trip Details</h1>
                <div class="px-6 py-2 font-medium rounded-md transition-colors-group">
                    @if(!in_array($trip->status, ['completed', 'cancelled']))
                        <a href="{{ route('clients.trips.standalone.edit', $trip) }}" class="inline-flex items-center px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i class="fas fa-edit mr-2"></i>Edit Trip
                        </a>
                        @if($trip->requiresApproval())
                            <button type="button" class="inline-flex items-center px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" onclick="approveTrip({{ $trip->id }})">
                                <i class="fas fa-check mr-2"></i>Approve
                            </button>
                        @endif
                        @if($trip->status === 'approved')
                            <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-info" onclick="startTrip({{ $trip->id }})">
                                <i class="fas fa-play mr-2"></i>Start Trip
                            </button>
                        @endif
                        @if($trip->status === 'in_progress')
                            <button type="button" class="inline-flex items-center px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" onclick="completeTrip({{ $trip->id }})">
                                <i class="fas fa-flag-checkered mr-2"></i>Complete Trip
                            </button>
                        @endif
                        <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-warning" onclick="cancelTrip({{ $trip->id }})">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    @endif
                    @if($trip->reimbursable && $trip->isCompleted() && !$trip->submitted_for_reimbursement)
                        <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-info" onclick="submitReimbursement({{ $trip->id }})">
                            <i class="fas fa-receipt mr-2"></i>Submit Reimbursement
                        </button>
                    @endif
                    <a href="{{ route('clients.trips.standalone.index') }}" class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Trips
                    </a>
                    <button type="button" 
                            class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-danger" 
                            onclick="deleteTrip({{ $trip->id }})">
                        <i class="fas fa-trash mr-2"></i>Delete
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap -mx-4">
                <div class="flex-1 px-6-lg-8">
                    <!-- Main Trip Details -->
                    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="px-6 py-6 border-b border-gray-200 bg-gray-50">
                            <div class="flex justify-between items-center">
                                <h5 class="bg-white rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-route mr-2"></i>{{ $trip->trip_number }}
                                </h5>
                                <div class="flex gap-2">
                                    @switch($trip->status)
                                        @case('planned')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600">Planned</span>
                                            @break
                                        @case('approved')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success">Approved</span>
                                            @break
                                        @case('in_progress')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600">In Progress</span>
                                            @break
                                        @case('completed')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success">Completed</span>
                                            @break
                                        @case('cancelled')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger">Cancelled</span>
                                            @break
                                        @case('postponed')
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning">Postponed</span>
                                            @break
                                    @endswitch

                                    @if($trip->billable_to_client)
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-info">Billable</span>
                                    @endif

                                    @if($trip->reimbursable)
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning">Reimbursable</span>
                                    @endif
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-wrap -mx-4">
                                <div class="md:w-1/2 px-6">
                                    <h6 class="text-gray-600">Trip Title</h6>
                                    <p class="mb-6 font-bold">{{ $trip->title }}</p>

                                    <h6 class="text-gray-600">Client</h6>
                                    <p class="mb-6">
                                        <a href="{{ route('clients.show', $trip->client) }}" class="text-decoration-none">
                                            {{ $trip->client->display_name }}
                                        </a>
                                    </p>

                                    <h6 class="text-gray-600 dark:text-gray-400">Trip Type</h6>
                                    <p class="mb-6">{{ ucfirst(str_replace('_', ' ', $trip->trip_type)) }}</p>

                                    @if($trip->purpose)
                                        <h6 class="text-gray-600 dark:text-gray-400">Purpose</h6>
                                        <p class="mb-6">{{ $trip->purpose }}</p>
                                    @endif

                                    @if($trip->description)
                                        <h6 class="text-gray-600 dark:text-gray-400">Description</h6>
                                        <div class="mb-6">
                                            {!! nl2br(e($trip->description)) !!}
                                        </div>
                                    @endif
                                </div>

                                <div class="md:w-1/2 px-6">
                                    <h6 class="text-gray-600 dark:text-gray-400">Destination</h6>
                                    <div class="mb-6">
                                        <div class="font-bold">{{ $trip->full_destination }}</div>
                                        @if($trip->mileage > 0)
                                            <small class="text-gray-600 dark:text-gray-400">
                                                <i class="fas fa-road mr-1"></i>{{ number_format($trip->mileage, 1) }} miles
                                            </small>
                                        @endif
                                    </div>

                                    <h6 class="text-gray-600 dark:text-gray-400">Transportation</h6>
                                    <p class="mb-6">{{ ucfirst(str_replace('_', ' ', $trip->transportation_mode)) }}</p>

                                    <h6 class="text-gray-600 dark:text-gray-400">Schedule</h6>
                                    <div class="mb-6">
                                        <div class="flex justify-between mb-1">
                                            <span>Start Date:</span>
                                            <span class="font-bold">{{ $trip->start_date->format('M j, Y') }}</span>
                                        </div>
                                        <div class="flex justify-between mb-1">
                                            <span>End Date:</span>
                                            <span class="font-bold">{{ $trip->end_date->format('M j, Y') }}</span>
                                        </div>
                                        <div class="flex justify-between mb-1">
                                            <span>Duration:</span>
                                            <span>{{ $trip->duration_in_days }} day(s)</span>
                                        </div>
                                        @if($trip->departure_time)
                                            <div class="flex justify-between mb-1">
                                                <span>Departure:</span>
                                                <span>{{ $trip->departure_time->format('M j, Y g:i A') }}</span>
                                            </div>
                                        @endif
                                        @if($trip->return_time)
                                            <div class="flex justify-between">
                                                <span>Return:</span>
                                                <span>{{ $trip->return_time->format('M j, Y g:i A') }}</span>
                                            </div>
                                        @endif
                                    </div>

                                    @if($trip->days_until_trip !== null)
                                        <div class="px-6 py-6 rounded bg-cyan-100 border border-cyan-400 text-cyan-700 py-2">
                                            <i class="fas fa-clock mr-2"></i>
                                            <strong>{{ $trip->time_until_trip }}</strong>
                                        </div>
                                    @endif
                                </div>
                            </div>

                            @if($trip->accommodation_details)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Accommodation</h6>
                                <div class="mb-6 p-6 bg-gray-100 rounded">
                                    {!! nl2br(e($trip->accommodation_details)) !!}
                                </div>
                            @endif

                            @if($trip->attendees && count($trip->attendees) > 0)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Attendees</h6>
                                <div class="mb-6">
                                    @foreach($trip->attendees as $attendee)
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-dark mr-2 mb-1">
                                            <i class="fas fa-user mr-1"></i>{{ $attendee }}
                                        </span>
                                    @endforeach
                                </div>
                            @endif

                            @if($trip->notes)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Notes</h6>
                                <div class="bg-light p-6 rounded">
                                    {!! nl2br(e($trip->notes)) !!}
                                </div>
                            @endif
                        </div>
                    </div>

                    <!-- Expense Details -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="px-6 py-6 border-b border-gray-200 bg-gray-50">
                            <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                <i class="fas fa-calculator mr-2"></i>Expense Details
                            </h5>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-wrap -mx-4">
                                <div class="flex-1 px-6-md-4">
                                    <div class="text-center p-6 bg-light rounded">
                                        <div class="font-bold text-cyan-600 dark:text-cyan-400 fs-5">{{ $trip->formatted_estimated_expenses }}</div>
                                        <small class="text-gray-600 dark:text-gray-400">Estimated Expenses</small>
                                    </div>
                                </div>
                                <div class="flex-1 px-6-md-4">
                                    <div class="text-center p-6 bg-light rounded">
                                        <div class="font-bold text-blue-600 fs-5">{{ $trip->formatted_actual_expenses }}</div>
                                        <small class="text-gray-600 dark:text-gray-400">Actual Expenses</small>
                                    </div>
                                </div>
                                <div class="flex-1 px-6-md-4">
                                    <div class="text-center p-6 bg-light rounded">
                                        @if($trip->expense_variance !== null)
                                            <div class="font-bold fs-5 {{ $trip->expense_variance > 0 ? 'text-red-600' : ($trip->expense_variance < 0 ? 'text-green-600' : 'text-cyan-600 dark:text-cyan-400') }}">
                                                {{ $trip->formatted_expense_variance }}
                                            </div>
                                        @else
                                            <div class="font-bold text-gray-600 dark:text-gray-400 fs-5">N/A</div>
                                        @endif
                                        <small class="text-gray-600 dark:text-gray-400">Variance</small>
                                    </div>
                                </div>
                            </div>

                            @if($trip->per_diem_amount > 0)
                                <div class="flex flex-wrap -mx-4 mt-6">
                                    <div class="flex-1 px-6-md-6">
                                        <div class="flex justify-between">
                                            <span>Per Diem Amount:</span>
                                            <span class="font-bold">{{ $trip->getCurrencySymbol() }}{{ number_format($trip->per_diem_amount, 2) }} / day</span>
                                        </div>
                                    </div>
                                    <div class="flex-1 px-6-md-6">
                                        <div class="flex justify-between">
                                            <span>Total Per Diem:</span>
                                            <span class="font-bold">{{ $trip->getCurrencySymbol() }}{{ number_format($trip->per_diem_amount * $trip->duration_in_days, 2) }}</span>
                                        </div>
                                    </div>
                                </div>
                            @endif

                            @if($trip->expense_breakdown && count($trip->expense_breakdown) > 0)
                                <hr>
                                <h6 class="text-gray-600 dark:text-gray-400">Expense Breakdown</h6>
                                <div class="min-w-full divide-y divide-gray-200-responsive">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 min-w-full divide-y divide-gray-200-sm">
                                        <thead class="min-w-full divide-y divide-gray-200 dark:divide-gray-700-light">
                                            <tr>
                                                <th>Category</th>
                                                <th class="text-end">Amount</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach($trip->expense_breakdown as $expense)
                                                <tr>
                                                    <td class="font-bold">{{ $expense['category'] }}</td>
                                                    <td class="text-end">{{ $trip->getCurrencySymbol() }}{{ number_format($expense['amount'], 2) }}</td>
                                                    <td class="text-gray-600 dark:text-gray-400">{{ $expense['description'] ?? '' }}</td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                        <tfoot class="min-w-full divide-y divide-gray-200 dark:divide-gray-700-light">
                                            <tr>
                                                <th>Total</th>
                                                <th class="text-end">{{ $trip->getCurrencySymbol() }}{{ number_format($trip->calculateTotalExpenses(), 2) }}</th>
                                                <th></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            @endif
                        </div>
                    </div>

                    <!-- Feedback Section (for completed trips) -->
                    @if($trip->isCompleted() && ($trip->client_feedback || $trip->internal_rating))
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                                <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-comments mr-2"></i>Trip Feedback
                                </h5>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                                @if($trip->client_feedback)
                                    <h6 class="text-gray-600 dark:text-gray-400">Client Feedback</h6>
                                    <div class="mb-6 p-6 bg-light rounded">
                                        {!! nl2br(e($trip->client_feedback)) !!}
                                    </div>
                                @endif

                                @if($trip->internal_rating)
                                    <h6 class="text-gray-600 dark:text-gray-400">Internal Rating</h6>
                                    <div class="mb-6">
                                        @for($i = 1; $i <= 5; $i++)
                                            <i class="fas fa-star {{ $i <= $trip->internal_rating ? 'text-yellow-600 dark:text-yellow-400' : 'text-gray-600 dark:text-gray-400' }}"></i>
                                        @endfor
                                        <span class="ml-2">{{ $trip->internal_rating }}/5</span>
                                        <span class="text-gray-600 dark:text-gray-400 ml-2">
                                            @switch($trip->internal_rating)
                                                @case(5) (Excellent) @break
                                                @case(4) (Very Good) @break
                                                @case(3) (Good) @break
                                                @case(2) (Fair) @break
                                                @case(1) (Poor) @break
                                            @endswitch
                                        </span>
                                    </div>
                                @endif
                            </div>
                        </div>
                    @endif
                </div>

                <div class="flex-1 px-6-lg-4">
                    <!-- Trip Status -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                            <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                <i class="fas fa-info-circle mr-2"></i>Trip Information
                            </h5>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <div class="small text-gray-600 dark:text-gray-400">
                                <div class="flex justify-between mb-2">
                                    <span>Trip Number:</span>
                                    <span class="font-bold">{{ $trip->trip_number }}</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>Currency:</span>
                                    <span>{{ $trip->currency }}</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span>Created:</span>
                                    <span>{{ $trip->created_at->format('M j, Y') }}</span>
                                </div>
                                @if($trip->creator)
                                    <div class="flex justify-between mb-2">
                                        <span>Created by:</span>
                                        <span>{{ $trip->creator->name }}</span>
                                    </div>
                                @endif
                                @if($trip->approved_at)
                                    <div class="flex justify-between mb-2">
                                        <span>Approved:</span>
                                        <span>{{ $trip->approved_at->format('M j, Y g:i A') }}</span>
                                    </div>
                                    @if($trip->approver)
                                        <div class="flex justify-between mb-2">
                                            <span>Approved by:</span>
                                            <span>{{ $trip->approver->name }}</span>
                                        </div>
                                    @endif
                                @endif
                                @if($trip->completed_at)
                                    <div class="flex justify-between">
                                        <span>Completed:</span>
                                        <span>{{ $trip->completed_at->format('M j, Y g:i A') }}</span>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                            <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                <i class="fas fa-bolt mr-2"></i>Quick Actions
                            </h5>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <div class="grid gap-2">
                                @if($trip->requiresApproval())
                                    <button class="btn bg-green-600 text-white hover:bg-green-700 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="approveTrip({{ $trip->id }})">
                                        <i class="fas fa-check mr-2"></i>Approve Trip
                                    </button>
                                @endif

                                @if($trip->status === 'approved')
                                    <button class="btn bg-cyan-600 text-white hover:bg-cyan-700 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="startTrip({{ $trip->id }})">
                                        <i class="fas fa-play mr-2"></i>Start Trip
                                    </button>
                                @endif

                                @if($trip->status === 'in_progress')
                                    <button class="btn bg-green-600 text-white hover:bg-green-700 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="completeTrip({{ $trip->id }})">
                                        <i class="fas fa-flag-checkered mr-2"></i>Complete Trip
                                    </button>
                                @endif

                                @if($trip->reimbursable && $trip->isCompleted() && !$trip->submitted_for_reimbursement)
                                    <button class="btn bg-yellow-500 text-white hover:bg-yellow-600 px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="submitReimbursement({{ $trip->id }})">
                                        <i class="fas fa-receipt mr-2"></i>Submit for Reimbursement
                                    </button>
                                @endif

                                @if(!in_array($trip->status, ['completed', 'cancelled']))
                                    <button class="btn btn-outline-warning px-6 py-2 font-medium rounded-md transition-colors-sm" onclick="cancelTrip({{ $trip->id }})">
                                        <i class="fas fa-times mr-2"></i>Cancel Trip
                                    </button>
                                @endif

                                <hr class="my-2">
                                
                                <a href="{{ route('clients.trips.standalone.create', ['client_id' => $trip->client_id]) }}" 
                                   class="btn btn-outline-info px-6 py-2 font-medium rounded-md transition-colors-sm">
                                    <i class="fas fa-plus mr-2"></i>New Trip for Client
                                </a>
                                
                                <a href="{{ route('clients.show', $trip->client) }}" 
                                   class="btn border border-gray-600 text-gray-600 hover:bg-gray-50 px-6 py-2 font-medium rounded-md transition-colors-sm">
                                    <i class="fas fa-user mr-2"></i>View Client
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Reimbursement Status -->
                    @if($trip->reimbursable)
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-header">
                                <h5 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title mb-0">
                                    <i class="fas fa-receipt mr-2"></i>Reimbursement Status
                                </h5>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                                @if($trip->submitted_for_reimbursement)
                                    <div class="px-6 py-6 rounded bg-green-100 border border-green-400 text-green-700">
                                        <i class="fas fa-check-circle mr-2"></i>
                                        Submitted for reimbursement
                                        @if($trip->reimbursement_amount)
                                            <br>Amount: {{ $trip->getCurrencySymbol() }}{{ number_format($trip->reimbursement_amount, 2) }}
                                        @endif
                                    </div>
                                    @if($trip->reimbursement_date)
                                        <div class="small text-gray-600 dark:text-gray-400">
                                            Reimbursed on: {{ $trip->reimbursement_date->format('M j, Y') }}
                                        </div>
                                    @endif
                                @elseif($trip->isCompleted())
                                    <div class="px-6 py-6 rounded bg-yellow-100 border border-yellow-400 text-yellow-700">
                                        <i class="fas fa-exclamation-triangle mr-2"></i>
                                        Ready for reimbursement submission
                                    </div>
                                @else
                                    <div class="text-gray-600 dark:text-gray-400">
                                        <i class="fas fa-clock mr-2"></i>
                                        Reimbursement available after trip completion
                                    </div>
                                @endif
                            </div>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Delete Trip Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="deleteTripModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Delete Trip</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Are you sure you want to delete this trip? This action cannot be undone.
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="inline-flex items-center px-6 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" @click="$dispatch('close-modal')">Cancel</button>
                <form id="deleteTripForm" method="POST" class="inline">
                    @csrf
                    @method('DELETE')
                    <button type="submit" class="inline-flex items-center px-6 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Delete Trip</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Approve Trip Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="approveTripModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Approve Trip</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Approve this trip? This will change the status to approved.
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="inline-flex items-center px-6 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" @click="$dispatch('close-modal')">Cancel</button>
                <form id="approveTripForm" method="POST" class="inline">
                    @csrf
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-success">Approve Trip</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Start Trip Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="startTripModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Start Trip</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-body">
                Start this trip? This will change the status to in progress.
            </div>
            <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                <form id="startTripForm" method="POST" class="inline">
                    @csrf
                    <button type="submit" class="inline-flex items-center px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Start Trip</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Complete Trip Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="completeTripModal" tabindex="-1">
    <div class="flex items-center justify-center min-h-screen fixed inset-0 z-50 overflow-y-auto-lg">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Complete Trip</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <form id="completeTripForm" method="POST">
                @csrf
                <div class="fixed inset-0 z-50 overflow-y-auto-body">
                    <p>Complete this trip by providing final details:</p>
                    
                    <div class="mb-6">
                        <label for="actual_expenses" class="block text-sm font-medium text-gray-700 mb-1">Actual Expenses</label>
                        <input type="number" class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" name="actual_expenses" id="actual_expenses" step="0.01" min="0" value="{{ $trip->actual_expenses }}">
                    </div>
                    
                    <div class="mb-6">
                        <label for="client_feedback" class="block text-sm font-medium text-gray-700 mb-1">Client Feedback</label>
                        <textarea class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" name="client_feedback" id="client_feedback" rows="3">{{ $trip->client_feedback }}</textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label for="internal_rating" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Internal Rating (1-5)</label>
                        <select class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" name="internal_rating" id="internal_rating">
                            <option value="">Select rating...</option>
                            <option value="5" {{ $trip->internal_rating == 5 ? 'selected' : '' }}>5 - Excellent</option>
                            <option value="4" {{ $trip->internal_rating == 4 ? 'selected' : '' }}>4 - Very Good</option>
                            <option value="3" {{ $trip->internal_rating == 3 ? 'selected' : '' }}>3 - Good</option>
                            <option value="2" {{ $trip->internal_rating == 2 ? 'selected' : '' }}>2 - Fair</option>
                            <option value="1" {{ $trip->internal_rating == 1 ? 'selected' : '' }}>1 - Poor</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input class="flex items-center-input" type="checkbox" name="follow_up_required" id="follow_up_required" {{ $trip->follow_up_required ? 'checked' : '' }}>
                        <label class="flex items-center-label" for="follow_up_required">
                            Follow-up required
                        </label>
                    </div>
                </div>
                <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                    <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-success">Complete Trip</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Cancel Trip Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="cancelTripModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Cancel Trip</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <form id="cancelTripForm" method="POST">
                @csrf
                <div class="fixed inset-0 z-50 overflow-y-auto-body">
                    <p>Are you sure you want to cancel this trip?</p>
                    <div class="mb-6">
                        <label for="cancelReason" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Reason (Optional)</label>
                        <textarea name="reason" id="cancelReason" class="block w-full px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" rows="3" placeholder="Reason for cancelling..."></textarea>
                    </div>
                </div>
                <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                    <button type="button" class="btn px-6 py-2 font-medium rounded-md transition-colors-secondary" @click="$dispatch('close-modal')">Cancel</button>
                    <button type="submit" class="btn px-6 py-2 font-medium rounded-md transition-colors-warning">Cancel Trip</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Submit Reimbursement Modal -->
<div class="fixed inset-0 z-50 overflow-y-auto fade" id="submitReimbursementModal" tabindex="-1">
    <div class="fixed inset-0 z-50 overflow-y-auto-dialog">
        <div class="fixed inset-0 z-50 overflow-y-auto-content">
            <div class="fixed inset-0 z-50 overflow-y-auto-header">
                <h5 class="fixed inset-0 z-50 overflow-y-auto-title">Submit for Reimbursement</h5>
                <button type="button" class="px-6 py-2 font-medium rounded-md transition-colors-close" @click="$dispatch('close-modal')"></button>
            </div>
            <form id="submitReimbursementForm" method="POST">
                @csrf
                <div class="fixed inset-0 z-50 overflow-y-auto-body">
                    <p>Submit this trip for expense reimbursement?</p>
                    <div class="mb-6">
                        <label for="reimbursementAmount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Reimbursement Amount <span class="text-red-600 dark:text-red-400