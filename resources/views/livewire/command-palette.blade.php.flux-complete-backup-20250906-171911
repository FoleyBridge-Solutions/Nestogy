<div>
    {{-- Trigger Button --}}
    <flux:tooltip content="Search (⌘K)">
        <flux:button
            wire:click="open"
            variant="ghost"
            size="sm"
            icon="magnifying-glass"
            class="text-zinc-400 hover:text-zinc-100"
        />
    </flux:tooltip>

    {{-- Command Palette Modal --}}
    <flux:modal wire:model="isOpen" variant="bare" class="w-full max-w-[40rem] my-[12vh] max-h-screen overflow-y-hidden">
        <flux:command class="border-none shadow-2xl inline-flex flex-col max-h-[76vh] bg-white dark:bg-zinc-900"
            @keydown.down.prevent="$wire.selectNext()"
            @keydown.up.prevent="$wire.selectPrevious()"
            @keydown.enter.prevent="$wire.selectResult()"
        >
            <flux:input 
                wire:model.live="search"
                placeholder="Search clients, tickets, assets, or type a command..."
                autofocus
                class="w-full"
            />
            
            {{-- Debug: Search = {{ $search }}, Results = {{ count($results) }} --}}
            @if(strlen($search) >= 2 && count($results) > 0)
                <flux:command.items>
                    @foreach($results as $index => $result)
                        @php
                            $iconName = $result['icon'] ?? 'document';
                        @endphp
                        <flux:command.item 
                            wire:click.prevent="selectResult({{ $index }})"
                            icon="{{ $iconName }}"
                            @class([
                                'bg-zinc-100 dark:bg-zinc-800' => $selectedIndex === $index
                            ])
                        >
                            <div class="flex items-center justify-between w-full">
                                <div>
                                    <div class="font-medium">{{ $result['title'] }}</div>
                                    <div class="text-xs text-zinc-500 dark:text-zinc-400">{{ $result['subtitle'] }}</div>
                                </div>
                                @if($result['type'] === 'action')
                                    <flux:icon name="arrow-right" variant="mini" class="w-4 h-4 text-zinc-400" />
                                @endif
                            </div>
                        </flux:command.item>
                    @endforeach
                </flux:command.items>
            @elseif(strlen($search) >= 2)
                <div class="px-4 py-8 text-center text-sm text-zinc-500 dark:text-zinc-400">
                    No results found for "{{ $search }}"
                </div>
            @else
                <flux:command.items>
                    <flux:command.item wire:click="navigateToRoute('dashboard')" icon="home" kbd="⌘H">
                        Go to Dashboard
                    </flux:command.item>
                    <flux:command.item wire:click="navigateToRoute('tickets.index')" icon="ticket" kbd="⌘T">
                        View All Tickets
                    </flux:command.item>
                    <flux:command.item wire:click="navigateToRoute('clients.index')" icon="building-office" kbd="⌘C">
                        View All Clients
                    </flux:command.item>
                    <flux:command.item wire:click="navigateToRoute('tickets.create')" icon="plus-circle">
                        Create New Ticket
                    </flux:command.item>
                    <flux:command.item wire:click="navigateToRoute('settings.index')" icon="cog-6-tooth" kbd="⌘,">
                        Settings
                    </flux:command.item>
                </flux:command.items>
            @endif
        </flux:command>
    </flux:modal>
</div>