@props(['field', 'value' => null, 'errors' => []])

@php
    $fieldSlug = $field['field_slug'];
    $hasError = !empty($errors[$fieldSlug]);
    $uiConfig = $field['ui_config'] ?? [];
    $inputClass = 'block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm' . ($hasError ? ' border-red-500' : '');
    
    // Extract UI configuration
    $format = $uiConfig['format'] ?? 'Y-m-d';
    $minDate = $uiConfig['min_date'] ?? null;
    $maxDate = $uiConfig['max_date'] ?? null;
    $disabledDates = $uiConfig['disabled_dates'] ?? [];
    $enableTime = $uiConfig['enable_time'] ?? false;
    
    // Format value for display
    $displayValue = $value;
    if ($value && !is_string($value)) {
        $displayValue = $value->format($format);
    }
@endphp

<div class="mb-4 mb-6">
    <label for="{{ $fieldSlug }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
        {{ $field['label'] }}
        @if($field['is_required'])
            <span class="text-red-600 dark:text-red-400">*</span>
        @endif
    </flux:label>
    
    <div class="flex">
        <input 
            type="date"
            id="{{ $fieldSlug }}"
            name="{{ $fieldSlug }}"
            class="{{ $inputClass }} flatpickr-date"
            value="{{ old($fieldSlug, $displayValue) }}"
            placeholder="{{ $field['placeholder'] ?? 'Select date...' }}"
            @if($field['is_required']) required @endif
            @if($minDate) min="{{ $minDate }}" @endif
            @if($maxDate) max="{{ $maxDate }}" @endif
            data-format="{{ $format }}"
            @if($enableTime) data-enable-time="true" @endif
            @if(!empty($disabledDates)) data-disabled-dates="{{ json_encode($disabledDates) }}" @endif
        />
        <span class="flex-text">
            <i class="fas fa-calendar"></i>
        </span>
    </div>
    
    @if($field['help_text'])
        <small class="form-text text-gray-600 dark:text-gray-400">{{ $field['help_text'] }}</small>
    @endif
    
    @if($hasError)
        <div class="text-red-600 text-sm mt-1">
            @foreach($errors[$fieldSlug] as $error)
                {{ $error }}
            @endforeach
        </div>
    @endif
</div>

@push('scripts')
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('{{ $fieldSlug }}');
        
        const config = {
            dateFormat: '{{ $format }}',
            @if($enableTime)
            enableTime: true,
            time_24hr: true,
            @endif
            @if($minDate)
            minDate: '{{ $minDate }}',
            @endif
            @if($maxDate)
            maxDate: '{{ $maxDate }}',
            @endif
            @if(!empty($disabledDates))
            disable: {!! json_encode($disabledDates) !!},
            @endif
            allowInput: true,
            clickOpens: true,
        };
        
        flatpickr(dateInput, config);
    });
</script>
@endpush