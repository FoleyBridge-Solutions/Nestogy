{{-- Advanced Item Selector Component --}}
{{-- This is an enhanced version of the product selector that integrates with the quote store --}}

<div x-data="productSelectorAdvanced()" 
     x-init="init()"
     class="item-selector-container mx-auto mx-auto px-4 mx-auto px-6"
     @client-selected.window="clientId = $event.detail.clientId">
    
    {{-- Header with Search and Filters --}}
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <div class="p-6">
            <div class="flex flex-wrap -mx-4 items-center">
                <div class="md:w-1/2 px-6">
                    <div class="flex">
                        <span class="flex-text">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text"
                               x-ref="searchInput"
                               x-model="searchQuery"
                               @input.debounce.300ms="quickSearch()"
                               class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                               placeholder="Search products, services, or bundles... (Press / to focus)">
                    </div>
                </div>
                
                <div class="md:w-1/2 px-6">
                    <div class="px-6 py-2 font-medium rounded-md transition-colors-group float-end" role="group">
                        <button type="button"
                                @click="showFilters = !showFilters"
                                class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                                :class="{ 'active': showFilters }">
                            <i class="fas fa-filter"></i>
                            Filters
                            <span x-show="hasFiltersApplied" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-600 ml-1" x-text="Object.values(filters).filter(f => f).length"></span>
                        </flux:button>
                        
                        <button type="button"
                                @click="viewMode = 'grid'"
                                class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                                :class="{ 'active': viewMode === 'grid' }">
                            <i class="fas fa-th"></i>
                        </flux:button>
                        
                        <button type="button"
                                @click="viewMode = 'list'"
                                class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                                :class="{ 'active': viewMode === 'list' }">
                            <i class="fas fa-list"></i>
                        </flux:button>
                    </div>
                </div>
            </div>
            
            {{-- Filter Panel --}}
            <div x-show="showFilters" x-transition class="mt-6">
                <div class="flex flex-wrap -mx-4">
                    <div class="flex-1 px-6-md-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="category-filter">Category</flux:label>
                        <select x-model="filters.category" id="category-filter" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm-sm">
                            <option value="">All Categories</option>
                            <template x-for="category in categories" :key="category">
                                <option :value="category" x-text="category"></option>
                            </template>
                        </flux:select>
                    </div>
                    
                    <div class="flex-1 px-6-md-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="billing-model-filter">Billing Model</flux:label>
                        <select x-model="filters.billingModel" id="billing-model-filter" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm block w-full px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm-sm">
                            <option value="">All Models</option>
                            <option value="one_time">One-time</option>
                            <option value="subscription">Subscription</option>
                            <option value="usage_based">Usage-based</option>
                        </flux:select>
                    </div>
                    
                    <div class="flex-1 px-6-md-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="price-range-min">Price Range</flux:label>
                        <div class="flex flex-sm">
                            <input type="number" 
                                   x-model="filters.priceRange.min" 
                                   id="price-range-min"
                                   class="block w-full px-6 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                                   placeholder="Min">
                            <span class="flex-text">-</span>
                            <input type="number" 
                                   x-model="filters.priceRange.max" 
                                   id="price-range-max"
                                   class="block w-full px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" 
                                   placeholder="Max">
                        </div>
                    </div>
                    
                    <div class="flex-1 px-6-md-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">&nbsp;</flux:label>
                        <button @click="clearFilters()" 
                                class="btn px-4 py-1 text-sm px-6 py-2 font-medium rounded-md transition-colors-outline-danger w-100">
                            Clear Filters
                        </flux:button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {{-- Tabs for Products, Services, Bundles --}}
    <ul class="nav nav-tabs mb-6" role="tablist">
        <li class="nav-item">
            <button class="nav-link"
                    :class="{ 'active': activeTab === 'products' }"
                    @click="switchTab('products')">
                <i class="fas fa-box"></i> Products
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600 ml-1" x-text="products.length"></span>
            </flux:button>
        </li>
        <li class="nav-item">
            <button class="nav-link"
                    :class="{ 'active': activeTab === 'services' }"
                    @click="switchTab('services')">
                <i class="fas fa-concierge-bell"></i> Services
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-600 ml-1" x-text="services.length"></span>
            </flux:button>
        </li>
        <li class="nav-item">
            <button class="nav-link"
                    :class="{ 'active': activeTab === 'bundles' }"
                    @click="switchTab('bundles')">
                <i class="fas fa-layer-group"></i> Bundles
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary ml-1" x-text="bundles.length"></span>
            </flux:button>
        </li>
    </ul>
    
    {{-- Loading State --}}
    <div x-show="loading" class="text-center py-8">
        <div class="spinner-border text-blue-600" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    {{-- Products Grid/List View --}}
    <div x-show="!loading && activeTab === 'products'">
        {{-- Sort Options --}}
        <div class="flex justify-between items-center mb-6">
            <div>
                <span class="text-gray-600">Showing <span x-text="products.length"></span> products</span>
            </div>
            <div class="btn-group px-6 py-2 font-medium rounded-md transition-colors-group-sm">
                <button @click="changeSort('name')" 
                        class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                        :class="{ 'active': sortBy === 'name' }">
                    Name
                    <i x-show="sortBy === 'name'" 
                       class="fas" 
                       :class="sortOrder === 'asc' ? 'fa-sort-up' : 'fa-sort-down'"></i>
                </flux:button>
                <button @click="changeSort('price')" 
                        class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                        :class="{ 'active': sortBy === 'price' }">
                    Price
                    <i x-show="sortBy === 'price'" 
                       class="fas" 
                       :class="sortOrder === 'asc' ? 'fa-sort-up' : 'fa-sort-down'"></i>
                </flux:button>
                <button @click="changeSort('newest')" 
                        class="btn px-6 py-2 font-medium rounded-md transition-colors-outline-secondary"
                        :class="{ 'active': sortBy === 'newest' }">
                    Newest
                </flux:button>
            </div>
        </div>
        
        {{-- Grid View --}}
        <div x-show="viewMode === 'grid'" class="flex flex-wrap -mx-4">
            <template x-for="product in products" :key="product.id">
                <div class="md:w-1/3 px-4 flex-1 px-6-lg-3 mb-6">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden h-100" 
                         :class="{ 'border-primary': isSelected(product.id, 'product') }">
                        <div class="p-6">
                            <h6 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title" x-text="product.name"></h6>
                            <p class="text-gray-600 small" x-text="product.sku"></p>
                            
                            <div class="mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary" x-text="product.category"></span>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-info" x-text="formatBillingCycle(product.billing_cycle)"></span>
                            </div>
                            
                            <div class="price-display mb-6">
                                <div class="h5 mb-0" x-text="formatPrice(product.base_price)"></div>
                            </div>
                            
                            <div class="flex justify-between">
                                <button @click="showProductDetails(product)"
                                        class="btn px-4 py-1 text-sm px-6 py-2 font-medium rounded-md transition-colors-outline-secondary">
                                    <i class="fas fa-info-circle"></i> Details
                                </flux:button>
                                
                                <button @click="toggleItem(product, 'product')"
                                        class="btn px-6 py-2 font-medium rounded-md transition-colors-sm"
                                        :class="isSelected(product.id, 'product') ? 'bg-blue-600 text-white hover:bg-blue-700' : 'px-6 py-2 font-medium rounded-md transition-colors-outline-primary'">
                                    <i class="fas" :class="isSelected(product.id, 'product') ? 'fa-check' : 'fa-plus'"></i>
                                    <span x-text="isSelected(product.id, 'product') ? 'Selected' : 'Select'"></span>
                                </flux:button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        {{-- List View --}}
        <div x-show="viewMode === 'list'" class="min-w-full divide-y divide-gray-200-responsive">
            <table class="min-w-full divide-y divide-gray-200 [&>tbody>tr:hover]:bg-gray-100">
                <thead>
                    <tr>
                        <th width="30" scope="col"></th>
                        <th scope="col">Product</th>
                        <th scope="col">SKU</th>
                        <th scope="col">Category</th>
                        <th scope="col">Billing</th>
                        <th scope="col">Price</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="product in products" :key="product.id">
                        <tr :class="{ 'min-w-full divide-y divide-gray-200 dark:divide-gray-700-primary': isSelected(product.id, 'product') }">
                            <td>
                                <input type="checkbox"
                                       :checked="isSelected(product.id, 'product')"
                                       @change="toggleItem(product, 'product')"
                                       class="flex items-center-input">
                            </td>
                            <td>
                                <strong x-text="product.name"></strong>
                            </td>
                            <td x-text="product.sku"></td>
                            <td>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary" x-text="product.category"></span>
                            </td>
                            <td>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-info" x-text="formatBillingCycle(product.billing_cycle)"></span>
                            </td>
                            <td>
                                <div x-text="formatPrice(product.base_price)"></div>
                            </td>
                            <td>
                                <button @click="showProductDetails(product)"
                                        class="btn px-4 py-1 text-sm px-6 py-2 font-medium rounded-md transition-colors-outline-secondary">
                                    <i class="fas fa-info-circle"></i>
                                </flux:button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
    
    {{-- Services View --}}
    <div x-show="!loading && activeTab === 'services'">
        <div class="flex flex-wrap -mx-4">
            <template x-for="service in services" :key="service.id">
                <div class="flex-1 px-6-md-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden h-100"
                         :class="{ 'border-primary': isSelected(service.id, 'service') }">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <h6 class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-title" x-text="service.name"></h6>
                            <p class="text-gray-600 dark:text-gray-400 small" x-text="service.service_type"></p>
                            
                            <div class="price-display mb-6">
                                <div class="h5 mb-0" x-text="formatPrice(service.base_price)"></div>
                            </div>
                            
                            <button @click="toggleItem(service, 'service')"
                                    class="px-6 py-2 font-medium rounded-md transition-colors w-100"
                                    :class="isSelected(service.id, 'service') ? 'bg-blue-600 text-white hover:bg-blue-700' : 'px-6 py-2 font-medium rounded-md transition-colors-outline-primary'">
                                <i class="fas" :class="isSelected(service.id, 'service') ? 'fa-check' : 'fa-plus'"></i>
                                <span x-text="isSelected(service.id, 'service') ? 'Selected' : 'Select'"></span>
                            </flux:button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    
    {{-- Bundles View --}}
    <div x-show="!loading && activeTab === 'bundles'">
        <div class="flex flex-wrap -mx-4">
            <template x-for="bundle in bundles" :key="bundle.id">
                <div class="md:w-1/2 px-4 flex-1 px-6-lg-4 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden h-100 border-success">
                        <div class="px-6 py-6 border-b border-gray-200 bg-gray-50 bg-success text-white">
                            <h6 class="mb-0" x-text="bundle.name"></h6>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden-body">
                            <p class="text-gray-600 dark:text-gray-400 small" x-text="bundle.description"></p>
                            
                            <div class="price-display mb-6">
                                <div x-show="bundle.fixed_price" class="h5 mb-0">
                                    <span x-text="formatPrice(bundle.fixed_price)"></span>
                                </div>
                            </div>
                            
                            <button @click="addBundle(bundle)"
                                    class="inline-flex items-center px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 w-100">
                                <i class="fas fa-layer-group"></i> Configure Bundle
                            </flux:button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    
    {{-- Pagination --}}
    <div x-show="totalPages > 1" class="flex justify-center mt-6">
        <nav>
            <ul class="pagination">
                <li class="page-item" :class="{ 'disabled': currentPage === 1 }">
                    <button class="page-link" @click="previousPage()">Previous</flux:button>
                </li>
                
                <template x-for="page in paginationRange" :key="page">
                    <li class="page-item" :class="{ 'active': currentPage === page }">
                        <button class="page-link" @click="goToPage(page)" x-text="page"></flux:button>
                    </li>
                </template>
                
                <li class="page-item" :class="{ 'disabled': currentPage === totalPages }">
                    <button class="page-link" @click="nextPage()">Next</flux:button>
                </li>
            </ul>
        </nav>
    </div>
    
    
    {{-- Product Details Modal --}}
    <div x-show="showProductModal" 
         class="fixed inset-0 z-50 overflow-y-auto fade show block" 
         tabindex="-1"
         style="background: rgba(0,0,0,0.5);">
        <div class="flex items-center justify-center min-h-screen fixed inset-0 z-50 overflow-y-auto-lg">
            <div class="fixed inset-0 z-50 overflow-y-auto-content" x-show="selectedProduct">
                <div class="fixed inset-0 z-50 overflow-y-auto-header">
                    <h5 class="fixed inset-0 z-50 overflow-y-auto-title" x-text="selectedProduct?.name"></h5>
                    <button type="button" 
                            class="px-6 py-2 font-medium rounded-md transition-colors-close" 
                            @click="closeProductModal()"></flux:button>
                </div>
                <div class="fixed inset-0 z-50 overflow-y-auto-body">
                    <div class="flex flex-wrap -mx-4">
                        <div class="flex-1 px-6-md-6">
                            <h6>Product Details</h6>
                            <dl class="flex flex-wrap -mx-4">
                                <dt class="flex-1 px-6-sm-4">SKU:</dt>
                                <dd class="flex-1 px-6-sm-8" x-text="selectedProduct?.sku"></dd>
                                
                                <dt class="flex-1 px-6-sm-4">Category:</dt>
                                <dd class="flex-1 px-6-sm-8" x-text="selectedProduct?.category"></dd>
                                
                                <dt class="flex-1 px-6-sm-4">Billing:</dt>
                                <dd class="flex-1 px-6-sm-8" x-text="formatBillingCycle(selectedProduct?.billing_cycle)"></dd>
                                
                                <dt class="flex-1 px-6-sm-4">Base Price:</dt>
                                <dd class="flex-1 px-6-sm-8" x-text="formatPrice(selectedProduct?.base_price)"></dd>
                            </dl>
                        </div>
                        
                        <div class="flex-1 px-6-md-6">
                            <h6>Description</h6>
                            <p x-text="selectedProduct?.description"></p>
                            
                            <div x-show="selectedProduct?.features">
                                <h6>Features</h6>
                                <ul>
                                    <template x-for="feature in selectedProduct?.features" :key="feature">
                                        <li x-text="feature"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div x-show="selectedProduct?.pricing_tiers?.length > 0" class="mt-6">
                        <h6>Volume Pricing</h6>
                        <table class="table min-w-full divide-y divide-gray-200 dark:divide-gray-700-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Quantity</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Discount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="tier in selectedProduct?.pricing_tiers" :key="tier.min_quantity">
                                    <tr>
                                        <td>
                                            <span x-text="tier.min_quantity"></span>
                                            <span x-show="tier.max_quantity">- <span x-text="tier.max_quantity"></span></span>
                                            <span x-show="!tier.max_quantity">+</span>
                                        </td>
                                        <td x-text="formatPrice(tier.price)"></td>
                                        <td>
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success" x-text="`${tier.discount_percentage.toFixed(0)}%`"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="fixed inset-0 z-50 overflow-y-auto-footer">
                    <button type="button" 
                            class="inline-flex items-center px-6 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" 
                            @click="closeProductModal()">Close</flux:button>
                    <button type="button" 
                            class="inline-flex items-center px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                            @click="toggleItem(selectedProduct, 'product'); closeProductModal();">
                        <i class="fas fa-plus"></i> Add to Selection
                    </flux:button>
                </div>
            </div>
        </div>
    </div>
</div>

{{-- JavaScript function provided by quote-integration-simple.js --}}