Migrated 19 permissions to Bouncer abilities.
Migrated 0 roles to Bouncer.
Migrated 0 role-permission relationships across 0 companies.
Migrated 0 user role assignments.
Migrated 0 direct user permissions.
Dropped legacy permission system tables.
The system now uses Bouncer for role and permission management.

   FAIL  Tests\Unit\Controllers\TicketControllerTest
  ✓ generate ticket number creates unique number                        14.20s  
  ⨯ generate ticket number increments sequence                           0.24s  
  ✓ get filter options returns correct structure                         0.19s  
  ✓ get filter options includes valid statuses                           0.20s  
  ✓ get filter options includes valid priorities                         0.17s  
  ✓ track ticket view stores in cache                                    0.25s  
  ✓ track ticket view stores user information                            0.24s  
  ✓ get ticket viewers excludes current user                             0.24s  
  ✓ get ticket viewers excludes old views                                0.26s  
  ✓ track ticket changes logs status changes                             0.24s  
  ✓ track ticket changes logs priority changes                           0.24s  
  ✓ track ticket changes logs assignment changes                         0.25s  
  ✓ get today time statistics returns correct structure                  0.25s  
  ⨯ get today time statistics calculates total hours                     0.24s  
  ✓ index request includes pagination                                    1.42s  
  ✓ index request applies sorting                                        0.25s  
  ✓ create request provides form data                                    0.18s  
  ✓ create request includes priority options                             0.17s  
  ✓ create request includes status options                               0.17s  
  ✓ export request generates csv headers                                 0.25s  
  ✓ search request requires minimum query length                         0.20s  
  ✓ search request limits results                                        0.70s  
  ✓ search request excludes closed tickets                               0.25s  

   FAIL  Tests\Feature\Controllers\TicketControllerTest
  ✓ index displays tickets list                                          0.78s  
  ✓ index filters by search term                                         0.31s  
  ✓ index filters by status                                              0.30s  
  ✓ index filters by priority                                            0.30s  
  ✓ index filters by assignee                                            0.31s  
  ✓ index filters overdue tickets                                        0.30s  
  ✓ index filters unassigned tickets                                     0.30s  
  ✓ index filters watched tickets                                        0.33s  
  ✓ create displays form                                                 0.40s  
  ✓ store creates ticket                                                 0.22s  
  ✓ store creates watcher for creator                                    0.22s  
  ⨯ store generates unique ticket number                                 0.23s  
  ✓ store validates required fields                                      0.21s  
  ✓ store validates client belongs to company                            0.23s  
  ✓ store validates priority values                                      0.21s  
  ✓ store returns json when requested                                    0.23s  
  ✓ show displays ticket                                                 0.63s  
  ✓ show tracks viewer                                                   0.47s  
  ✓ show returns json when requested                                     0.24s  
  ✓ edit displays form                                                   0.48s  
  ✓ update modifies ticket                                               0.24s  
  ✓ update validates input                                               0.26s  
  ✓ destroy soft deletes ticket                                          0.26s  
  ✓ destroy returns json when requested                                  0.26s  
  ✓ assign updates ticket assignee                                       0.28s  
  ✓ assign creates watcher for assignee                                  0.30s  
  ✓ assign validates assignee belongs to company                         0.27s  
  ✓ update status changes ticket status                                  0.24s  
  ✓ update status sets closed timestamps                                 0.26s  
  ✓ update priority changes ticket priority                              0.26s  
  ✓ schedule creates calendar event                                      0.27s  
  ✓ schedule validates future date                                       0.24s  
  ✓ merge moves data to target ticket                                    0.31s  
  ⨯ merge validates target ticket exists                                 0.25s  
  ✓ merge prevents self merge                                            0.27s  
  ✓ export generates csv                                                 0.31s  
  ⨯ search finds tickets by number                                       0.26s  
  ⨯ search finds tickets by subject                                      0.24s  
  ✓ search excludes specified ticket                                     0.28s  
  ✓ get viewers returns other viewers                                    0.27s  
  ✓ start smart timer creates time entry                                 0.34s  
  ✓ stop timer ends active timer                                         0.23s  
  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\Controllers\TicketControllerTest > generate ticket num…   
  Failed asserting that 1 is greater than 1.

  at tests/Unit/Controllers/TicketControllerTest.php:84
     80▕ 
     81▕         $number = $method->invoke($this->controller);
     82▕ 
     83▕         $this->assertStringStartsWith("TKT-{$currentYear}-", $number);
  ➜  84▕         $this->assertGreaterThan(1, intval(substr($number, -6)));
     85▕     }
     86▕ 
     87▕     public function test_get_filter_options_returns_correct_structure(): void
     88▕     {

  1   tests/Unit/Controllers/TicketControllerTest.php:84

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\Controllers\TicketControllerTest > get today time stat…   
  Failed asserting that 1 is equal to 2 or is greater than 2.

  at tests/Unit/Controllers/TicketControllerTest.php:340
    336▕         $stats = $method->invoke($this->controller, $this->user);
    337▕ 
    338▕         $this->assertGreaterThanOrEqual(4.0, $stats['total_hours']);
    339▕         $this->assertGreaterThanOrEqual(2.5, $stats['billable_hours']);
  ➜ 340▕         $this->assertGreaterThanOrEqual(2, $stats['entries_count']);
    341▕     }
    342▕ 
    343▕     public function test_index_request_includes_pagination(): void
    344▕     {

  1   tests/Unit/Controllers/TicketControllerTest.php:340

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > store generates…    
  Expected: 1001

  To contain: TKT

  at tests/Feature/Controllers/TicketControllerTest.php:307
    303▕             ->where('company_id', $this->user->company_id)
    304▕             ->first();
    305▕         $this->assertNotNull($ticket);
    306▕         $this->assertNotNull($ticket->number);
  ➜ 307▕         $this->assertStringContainsString('TKT', $ticket->number);
    308▕         $this->assertStringContainsString(date('Y'), $ticket->number);
    309▕     }
    310▕ 
    311▕     public function test_store_validates_required_fields(): void

  1   tests/Feature/Controllers/TicketControllerTest.php:307

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > merge validates…    
  Expected response status code [404] but received 500.
Failed asserting that 500 is identical to 404.

  at tests/Feature/Controllers/TicketControllerTest.php:690
    686▕             ->postJson(route('tickets.merge', $ticket), [
    687▕                 'merge_into_number' => 'INVALID-999999',
    688▕             ]);
    689▕ 
  ➜ 690▕         $response->assertStatus(404);
    691▕     }
    692▕ 
    693▕     public function test_merge_prevents_self_merge(): void
    694▕     {

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > search finds tic…   
  Failed to assert that the response count matched the expected 1
Failed asserting that actual size 0 matches expected size 1.

  at tests/Feature/Controllers/TicketControllerTest.php:733
    729▕         $response = $this->actingAs($this->user)
    730▕             ->getJson(route('tickets.search', ['q' => '000001']));
    731▕ 
    732▕         $response->assertStatus(200);
  ➜ 733▕         $response->assertJsonCount(1, 'tickets');
    734▕     }
    735▕ 
    736▕     public function test_search_finds_tickets_by_subject(): void
    737▕     {

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > search finds tic…   
  Failed to assert that the response count matched the expected 1
Failed asserting that actual size 0 matches expected size 1.

  at tests/Feature/Controllers/TicketControllerTest.php:748
    744▕         $response = $this->actingAs($this->user)
    745▕             ->getJson(route('tickets.search', ['q' => 'Email']));
    746▕ 
    747▕         $response->assertStatus(200);
  ➜ 748▕         $response->assertJsonCount(1, 'tickets');
    749▕     }
    750▕ 
    751▕     public function test_search_excludes_specified_ticket(): void
    752▕     {


  Tests:    6 failed, 59 passed (171 assertions)
  Duration: 33.61s

