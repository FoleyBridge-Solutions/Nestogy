Migrated 19 permissions to Bouncer abilities.
Migrated 0 roles to Bouncer.
Migrated 0 role-permission relationships across 0 companies.
Migrated 0 user role assignments.
Migrated 0 direct user permissions.
Dropped legacy permission system tables.
The system now uses Bouncer for role and permission management.

   FAIL  Tests\Unit\Controllers\TicketControllerTest
  âœ“ generate ticket number creates unique number                        14.16s  
  â¨¯ generate ticket number increments sequence                           0.24s  
  âœ“ get filter options returns correct structure                         0.18s  
  âœ“ get filter options includes valid statuses                           0.19s  
  âœ“ get filter options includes valid priorities                         0.16s  
  âœ“ track ticket view stores in cache                                    0.25s  
  âœ“ track ticket view stores user information                            0.22s  
  âœ“ get ticket viewers excludes current user                             0.26s  
  âœ“ get ticket viewers excludes old views                                0.23s  
  âœ“ track ticket changes logs status changes                             0.22s  
  âœ“ track ticket changes logs priority changes                           0.23s  
  âœ“ track ticket changes logs assignment changes                         0.23s  
  âœ“ get today time statistics returns correct structure                  0.24s  
  â¨¯ get today time statistics calculates total hours                     0.26s  
  âœ“ index request includes pagination                                    1.45s  
  âœ“ index request applies sorting                                        0.25s  
  âœ“ create request provides form data                                    0.18s  
  âœ“ create request includes priority options                             0.18s  
  âœ“ create request includes status options                               0.17s  
  âœ“ export request generates csv headers                                 0.27s  
  âœ“ search request requires minimum query length                         0.16s  
  âœ“ search request limits results                                        0.70s  
  âœ“ search request excludes closed tickets                               0.26s  

   FAIL  Tests\Feature\Controllers\TicketControllerTest
  âœ“ index displays tickets list                                          0.81s  
  âœ“ index filters by search term                                         0.34s  
  âœ“ index filters by status                                              0.30s  
  âœ“ index filters by priority                                            0.28s  
  âœ“ index filters by assignee                                            0.29s  
  âœ“ index filters overdue tickets                                        0.30s  
  âœ“ index filters unassigned tickets                                     0.31s  
  âœ“ index filters watched tickets                                        0.33s  
  âœ“ create displays form                                                 0.40s  
  â¨¯ store creates ticket                                                 0.23s  
  â¨¯ store creates watcher for creator                                    0.23s  
  â¨¯ store generates unique ticket number                                 0.24s  
  âœ“ store validates required fields                                      0.20s  
  âœ“ store validates client belongs to company                            0.24s  
  âœ“ store validates priority values                                      0.21s  
  â¨¯ store returns json when requested                                    0.21s  
  âœ“ show displays ticket                                                 0.64s  
  âœ“ show tracks viewer                                                   0.47s  
  âœ“ show returns json when requested                                     0.28s  
  âœ“ edit displays form                                                   0.49s  
  âœ“ update modifies ticket                                               0.27s  
  âœ“ update validates input                                               0.25s  
  âœ“ destroy soft deletes ticket                                          0.28s  
  âœ“ destroy returns json when requested                                  0.26s  
  âœ“ assign updates ticket assignee                                       0.28s  
  âœ“ assign creates watcher for assignee                                  0.27s  
  âœ“ assign validates assignee belongs to company                         0.28s  
  âœ“ update status changes ticket status                                  0.28s  
  âœ“ update status sets closed timestamps                                 0.30s  
  âœ“ update priority changes ticket priority                              0.28s  
  âœ“ schedule creates calendar event                                      0.25s  
  âœ“ schedule validates future date                                       0.25s  
  âœ“ merge moves data to target ticket                                    0.33s  
  â¨¯ merge validates target ticket exists                                 0.28s  
  âœ“ merge prevents self merge                                            0.26s  
  âœ“ export generates csv                                                 0.35s  
  â¨¯ search finds tickets by number                                       0.21s  
  âœ“ search finds tickets by subject                                      0.24s  
  âœ“ search excludes specified ticket                                     0.30s  
  âœ“ get viewers returns other viewers                                    0.29s  
  âœ“ start smart timer creates time entry                                 0.35s  
  âœ“ stop timer ends active timer                                         0.28s  
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\Controllers\TicketControllerTest > genâ€¦  QueryException   
  SQLSTATE[22P02]: Invalid text representation: 7 ERROR:  invalid input syntax for type integer: "TKT-2025-000001"
CONTEXT:  unnamed portal parameter $6 = '...' (Connection: pgsql, SQL: insert into "tickets" ("company_id", "client_id", "created_by", "assigned_to", "prefix", "number", "subject", "details", "priority", "status", "category", "source", "billable", "onsite", "scheduled_at", "closed_at", "created_at", "updated_at") values (2, 2, 3, ?, TKT, TKT-2025-000001, Magni aperiam voluptatem ipsa praesentium., Expedita animi omnis quod enim quos. Adipisci rem quia asperiores. Velit rerum autem quam laboriosam ratione.

Doloribus eaque labore dolor sunt mollitia aut odio. Soluta et autem sed aspernatur sed.

Placeat fuga aut animi beatae officia ullam. Fugit ea sit architecto fugit et voluptas., high, closed, Hardware, walk-in, 1, 0, ?, ?, 2025-04-27 19:06:10, 2025-04-27 19:06:10) returning "id")

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821â–•                 );
    822â–•             }
    823â–• 
  âžœ 824â–•             throw new QueryException(
    825â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826â–•             );
    827â–•         }
    828â–•     }

      [2m+18 vendor frames [22m
  19  tests/Unit/Controllers/TicketControllerTest.php:71

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\Controllers\TicketControllerTest > get today time statâ€¦   
  Failed asserting that 1 is equal to 2 or is greater than 2.

  at tests/Unit/Controllers/TicketControllerTest.php:340
    336â–•         $stats = $method->invoke($this->controller, $this->user);
    337â–• 
    338â–•         $this->assertGreaterThanOrEqual(4.0, $stats['total_hours']);
    339â–•         $this->assertGreaterThanOrEqual(2.5, $stats['billable_hours']);
  âžœ 340â–•         $this->assertGreaterThanOrEqual(2, $stats['entries_count']);
    341â–•     }
    342â–• 
    343â–•     public function test_index_request_includes_pagination(): void
    344â–•     {

  1   tests/Unit/Controllers/TicketControllerTest.php:340

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > store creates tiâ€¦   
  Failed asserting that a row in the table [tickets] matches the attributes {
    "subject": "Test Ticket",
    "client_id": 33,
    "company_id": 110,
    "priority": "High",
    "status": "open"
}.

The table is empty.

  at tests/Feature/Controllers/TicketControllerTest.php:262
    258â–•         
    259â–•         if ($response->exception) {
    260â–•             throw $response->exception;
    261â–•         }
  âžœ 262â–•         $this->assertDatabaseHas('tickets', [
    263â–•             'subject' => 'Test Ticket',
    264â–•             'client_id' => $this->client->id,
    265â–•             'company_id' => $this->user->company_id,
    266â–•             'priority' => 'High',

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest >â€¦   ErrorException   
  Attempt to read property "id" on null

  at tests/Feature/Controllers/TicketControllerTest.php:285
    281â–•         $response = $this->actingAs($this->user)->post(route('tickets.store'), $data);
    282â–• 
    283â–•         $ticket = Ticket::where('subject', 'Test Ticket')->first();
    284â–•         $this->assertDatabaseHas('ticket_watchers', [
  âžœ 285â–•             'ticket_id' => $ticket->id,
    286â–•             'user_id' => $this->user->id,
    287â–•         ]);
    288â–•     }
    289â–•

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > store generatesâ€¦    
  Failed asserting that null is not null.

  at tests/Feature/Controllers/TicketControllerTest.php:305
    301â–• 
    302â–•         $ticket = Ticket::where('subject', 'Test Ticket Unique')
    303â–•             ->where('company_id', $this->user->company_id)
    304â–•             ->first();
  âžœ 305â–•         $this->assertNotNull($ticket);
    306â–•         $this->assertNotNull($ticket->number);
    307â–•         $this->assertStringContainsString('TKT', $ticket->number);
    308â–•         $this->assertStringContainsString(date('Y'), $ticket->number);
    309â–•     }

  1   tests/Feature/Controllers/TicketControllerTest.php:305

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > store returns jsâ€¦   
  Expected response status code [201] but received 500.
Failed asserting that 500 is identical to 201.

  at tests/Feature/Controllers/TicketControllerTest.php:364
    360â–• 
    361â–•         $response = $this->actingAs($this->user)
    362â–•             ->postJson(route('tickets.store'), $data);
    363â–• 
  âžœ 364â–•         $response->assertStatus(201);
    365â–•         $response->assertJsonStructure([
    366â–•             'success',
    367â–•             'message',
    368â–•             'ticket' => ['id', 'subject', 'client', 'assignee'],

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest > merge validatesâ€¦    
  Expected response status code [404] but received 500.
Failed asserting that 500 is identical to 404.

  at tests/Feature/Controllers/TicketControllerTest.php:690
    686â–•             ->postJson(route('tickets.merge', $ticket), [
    687â–•                 'merge_into_number' => 'INVALID-999999',
    688â–•             ]);
    689â–• 
  âžœ 690â–•         $response->assertStatus(404);
    691â–•     }
    692â–• 
    693â–•     public function test_merge_prevents_self_merge(): void
    694â–•     {

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Feature\Controllers\TicketControllerTest >â€¦   QueryException   
  SQLSTATE[22P02]: Invalid text representation: 7 ERROR:  invalid input syntax for type integer: "TKT-2025-000001"
CONTEXT:  unnamed portal parameter $6 = '...' (Connection: pgsql, SQL: insert into "tickets" ("company_id", "client_id", "created_by", "assigned_to", "prefix", "number", "subject", "details", "priority", "status", "category", "source", "billable", "onsite", "scheduled_at", "closed_at", "created_at", "updated_at") values (162, 61, 204, ?, TKT, TKT-2025-000001, Quia iusto perspiciatis odit mollitia., Rem quisquam optio veritatis aut qui. Blanditiis consectetur aut minima ex rem aut eos odit. Odio necessitatibus aut culpa harum fugiat aliquid tempora.

Nihil ad possimus delectus quo necessitatibus expedita. Et molestias rem exercitationem. Neque ducimus ducimus quia similique hic.

Culpa temporibus cum sit ad omnis vitae ex. Cumque accusantium natus maxime illum. Rerum sit reiciendis totam est ut., high, pending, Other, monitoring, 0, 0, ?, ?, 2025-06-28 18:49:30, 2025-06-28 18:49:30) returning "id")

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821â–•                 );
    822â–•             }
    823â–• 
  âžœ 824â–•             throw new QueryException(
    825â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826â–•             );
    827â–•         }
    828â–•     }

      [2m+18 vendor frames [22m
  19  tests/Feature/Controllers/TicketControllerTest.php:723


  Tests:    8 failed, 57 passed (157 assertions)
  Duration: 33.91s

