PHPUnit 11.5.42 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.12 with PCOV 1.0.12
Configuration: /opt/nestogy/phpunit.xml

Migrated 19 permissions to Bouncer abilities.
Migrated 0 roles to Bouncer.
Migrated 0 role-permission relationships across 0 companies.
Migrated 0 user role assignments.
Migrated 0 direct user permissions.
Dropped legacy permission system tables.
The system now uses Bouncer for role and permission management.
...............................................................  63 / 891 (  7%)
............................................................... 126 / 891 ( 14%)
............................................................... 189 / 891 ( 21%)
............................................................... 252 / 891 ( 28%)
............................................................... 315 / 891 ( 35%)
................E.............................................. 378 / 891 ( 42%)
............................................................... 441 / 891 ( 49%)
...................................EE..EE....EFEE.F............ 504 / 891 ( 56%)
............................................................... 567 / 891 ( 63%)
............................................................... 630 / 891 ( 70%)
............................................................... 693 / 891 ( 77%)
............................................................... 756 / 891 ( 84%)
............................................................... 819 / 891 ( 91%)
............................................................... 882 / 891 ( 98%)
.........                                                       891 / 891 (100%)

Time: 03:36.337, Memory: 423.00 MB

There were 8 errors:

1) Tests\Unit\Models\PricingRuleTest::test_pricing_rule_belongs_to_company
Illuminate\Database\QueryException: SQLSTATE[22003]: Numeric value out of range: 7 ERROR:  numeric field overflow
DETAIL:  A field with precision 10, scale 2 must round to an absolute value less than 10^8. (Connection: pgsql, SQL: insert into "pricing_rules" ("company_id", "product_id", "name", "pricing_model", "discount_type", "discount_value", "price_override", "min_quantity", "max_quantity", "quantity_increment", "valid_from", "applicable_days", "applicable_hours", "is_promotional", "promo_code", "conditions", "priority", "is_active", "is_combinable", "max_uses", "uses_count", "max_uses_per_client", "requires_approval", "approval_threshold", "updated_at", "created_at") values (474, 4, corporis maiores molestias, tiered, percentage, ?, 7874.44, ?, 43, 37, 2025-09-27 11:05:55, 66479061, ?, 1, adipisci, ?, 12, 0, 0, 14468, 53, 12, 0, 320096382, 2025-10-05 07:52:12, 2025-10-05 07:52:12) returning "id")

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Models/PricingRuleTest.php:33

Caused by
PDOException: SQLSTATE[22003]: Numeric value out of range: 7 ERROR:  numeric field overflow
DETAIL:  A field with precision 10, scale 2 must round to an absolute value less than 10^8.

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:411
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:811
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Models/PricingRuleTest.php:33

2) Tests\Unit\Services\ContractGenerationServiceTest::test_generate_from_quote_creates_contract
Exception: Quote must be accepted before generating contract

/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:272
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:66
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:58
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:54

3) Tests\Unit\Services\ContractGenerationServiceTest::test_generate_from_quote_with_customizations
Exception: Quote must be accepted before generating contract

/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:272
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:66
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:58
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:80

4) Tests\Unit\Services\ContractGenerationServiceTest::test_create_custom_contract
Illuminate\Database\QueryException: SQLSTATE[23502]: Not null violation: 7 ERROR:  null value in column "contract_type" of relation "contracts" violates not-null constraint
DETAIL:  Failing row contains (3, 667, CNT-0001, null, Custom Contract, Custom contract for special services, draft, 297, 15000.00, USD, null, 0.00, 0.00, 2025-10-05, 2026-04-05, null, null, null, null, null, null, f, null, null, null, null, 109, null, null, null, f, null, null, null, null, 2025-10-05 07:52:40, 2025-10-05 07:52:40, null, pending, fixed, null, null, null, null, null, null, null, null, null, null, null, null, 0, 0, 0.00, 0.00, 0.00, null, null, f, t, f, null, f, null, null, null, null, null, null, null, null, null, null). (Connection: pgsql, SQL: insert into "contracts" ("company_id", "contract_number", "currency_code", "status", "signature_status", "created_by", "client_id", "title", "start_date", "end_date", "contract_value", "description", "updated_at", "created_at") values (667, CNT-0001, USD, draft, pending, 109, 297, Custom Contract, 2025-10-05 00:00:00, 2026-04-05 00:00:00, 15000, Custom contract for special services, 2025-10-05 07:52:40, 2025-10-05 07:52:40) returning "id")

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1219
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/helpers.php:390
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1218
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Traits/ForwardsCalls.php:23
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2540
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2556
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:152
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:143
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:145

Caused by
PDOException: SQLSTATE[23502]: Not null violation: 7 ERROR:  null value in column "contract_type" of relation "contracts" violates not-null constraint
DETAIL:  Failing row contains (3, 667, CNT-0001, null, Custom Contract, Custom contract for special services, draft, 297, 15000.00, USD, null, 0.00, 0.00, 2025-10-05, 2026-04-05, null, null, null, null, null, null, f, null, null, null, null, 109, null, null, null, f, null, null, null, null, 2025-10-05 07:52:40, 2025-10-05 07:52:40, null, pending, fixed, null, null, null, null, null, null, null, null, null, null, null, null, 0, 0, 0.00, 0.00, 0.00, null, null, f, t, f, null, f, null, null, null, null, null, null, null, null, null, null).

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:411
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:811
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1219
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/helpers.php:390
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1218
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Traits/ForwardsCalls.php:23
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2540
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2556
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:152
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:143
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:145

5) Tests\Unit\Services\ContractGenerationServiceTest::test_create_custom_contract_with_milestones
Illuminate\Database\QueryException: SQLSTATE[23502]: Not null violation: 7 ERROR:  null value in column "contract_type" of relation "contracts" violates not-null constraint
DETAIL:  Failing row contains (4, 668, CNT-0001, null, Project Contract, null, draft, 298, 0.00, USD, null, 0.00, 0.00, 2025-10-05, null, null, null, null, null, null, null, f, null, null, null, null, 110, null, null, null, f, null, null, null, null, 2025-10-05 07:52:40, 2025-10-05 07:52:40, null, pending, fixed, null, null, null, null, null, null, null, null, null, null, null, null, 0, 0, 0.00, 0.00, 0.00, null, null, f, t, f, null, f, null, null, null, null, null, null, null, null, null, null). (Connection: pgsql, SQL: insert into "contracts" ("company_id", "contract_number", "currency_code", "status", "signature_status", "created_by", "client_id", "title", "start_date", "updated_at", "created_at") values (668, CNT-0001, USD, draft, pending, 110, 298, Project Contract, 2025-10-05 00:00:00, 2025-10-05 07:52:40, 2025-10-05 07:52:40) returning "id")

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1219
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/helpers.php:390
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1218
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Traits/ForwardsCalls.php:23
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2540
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2556
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:152
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:143
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:175

Caused by
PDOException: SQLSTATE[23502]: Not null violation: 7 ERROR:  null value in column "contract_type" of relation "contracts" violates not-null constraint
DETAIL:  Failing row contains (4, 668, CNT-0001, null, Project Contract, null, draft, 298, 0.00, USD, null, 0.00, 0.00, 2025-10-05, null, null, null, null, null, null, null, f, null, null, null, null, 110, null, null, null, f, null, null, null, null, 2025-10-05 07:52:40, 2025-10-05 07:52:40, null, pending, fixed, null, null, null, null, null, null, null, null, null, null, null, null, 0, 0, 0.00, 0.00, 0.00, null, null, f, t, f, null, f, null, null, null, null, null, null, null, null, null, null).

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:411
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:811
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1219
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/helpers.php:390
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:1218
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Traits/ForwardsCalls.php:23
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2540
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2556
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:152
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:143
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:175

6) Tests\Unit\Services\ContractGenerationServiceTest::test_full_contract_lifecycle_from_quote
Exception: Quote must be accepted before generating contract

/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:272
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:66
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php:35
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php:489
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php:363
/opt/nestogy/app/Domains/Contract/Services/ContractGenerationService.php:58
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:269

7) Tests\Unit\Services\ContractGenerationServiceTest::test_contract_generation_handles_company_isolation
Illuminate\Database\QueryException: SQLSTATE[23514]: Check violation: 7 ERROR:  new row for relation "contract_templates" violates check constraint "contract_templates_status_check"
DETAIL:  Failing row contains (9, 682, maiores ipsum debitis, ipsam-rem-sit-minus-qui, Similique doloribus eveniet voluptates sit et tempore praesentiu..., custom, null, ["repellat","eius","corporis"], inactive, 1.0, null, f, null, null, ["client_id","start_date","end_date"], fixed, null, null, null, null, 199.52, null, null, 32.30, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 0, null, null, t, null, null, null, null, null, null, 123, null, null, 2025-10-05 07:52:42, 2025-10-05 07:52:42, null, null). (Connection: pgsql, SQL: insert into "contract_templates" ("company_id", "name", "slug", "description", "template_type", "category", "tags", "status", "version", "parent_template_id", "is_default", "variable_fields", "default_values", "required_fields", "voip_service_types", "default_sla_terms", "default_pricing_structure", "compliance_templates", "jurisdictions", "regulatory_requirements", "legal_disclaimers", "customization_options", "conditional_clauses", "pricing_models", "billing_model", "asset_billing_rules", "supported_asset_types", "asset_service_matrix", "default_per_asset_rate", "contact_billing_rules", "contact_access_tiers", "default_per_contact_rate", "calculation_formulas", "auto_assignment_rules", "billing_triggers", "workflow_automation", "notification_triggers", "integration_hooks", "usage_count", "last_used_at", "success_rate", "requires_approval", "approval_workflow", "last_reviewed_at", "next_review_date", "metadata", "rendering_options", "signature_settings", "created_by", "updated_by", "approved_by", "updated_at", "created_at") values (682, maiores ipsum debitis, ipsam-rem-sit-minus-qui, Similique doloribus eveniet voluptates sit et tempore praesentium nulla., custom, ?, ["repellat","eius","corporis"], inactive, 1.0, ?, 0, ?, ?, ["client_id","start_date","end_date"], ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, fixed, ?, ?, ?, 199.52, ?, ?, 32.3, ?, ?, ?, ?, ?, ?, 0, ?, ?, 1, ?, ?, ?, ?, ?, ?, 123, ?, ?, 2025-10-05 07:52:42, 2025-10-05 07:52:42) returning "id")

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:317

Caused by
PDOException: SQLSTATE[23514]: Check violation: 7 ERROR:  new row for relation "contract_templates" violates check constraint "contract_templates_status_check"
DETAIL:  Failing row contains (9, 682, maiores ipsum debitis, ipsam-rem-sit-minus-qui, Similique doloribus eveniet voluptates sit et tempore praesentiu..., custom, null, ["repellat","eius","corporis"], inactive, 1.0, null, f, null, null, ["client_id","start_date","end_date"], fixed, null, null, null, null, 199.52, null, null, 32.30, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 0, null, null, t, null, null, null, null, null, null, 123, null, null, 2025-10-05 07:52:42, 2025-10-05 07:52:42, null, null).

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:411
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:811
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:317

8) Tests\Unit\Services\ContractGenerationServiceTest::test_generate_from_quote_validates_quote_status
Illuminate\Database\QueryException: SQLSTATE[23514]: Check violation: 7 ERROR:  new row for relation "contract_templates" violates check constraint "contract_templates_status_check"
DETAIL:  Failing row contains (10, 684, asperiores quae cupiditate, beatae-quia-dolores-rem-necessitatibus-sint-voluptatem, null, custom, ullam, ["nostrum","numquam","illum"], inactive, 1.0, null, f, null, null, ["client_id","start_date","end_date"], fixed, null, null, null, null, null, null, null, 75.26, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 0, null, null, f, null, null, null, null, null, null, 124, null, null, 2025-10-05 07:52:42, 2025-10-05 07:52:42, null, null). (Connection: pgsql, SQL: insert into "contract_templates" ("company_id", "name", "slug", "description", "template_type", "category", "tags", "status", "version", "parent_template_id", "is_default", "variable_fields", "default_values", "required_fields", "voip_service_types", "default_sla_terms", "default_pricing_structure", "compliance_templates", "jurisdictions", "regulatory_requirements", "legal_disclaimers", "customization_options", "conditional_clauses", "pricing_models", "billing_model", "asset_billing_rules", "supported_asset_types", "asset_service_matrix", "default_per_asset_rate", "contact_billing_rules", "contact_access_tiers", "default_per_contact_rate", "calculation_formulas", "auto_assignment_rules", "billing_triggers", "workflow_automation", "notification_triggers", "integration_hooks", "usage_count", "last_used_at", "success_rate", "requires_approval", "approval_workflow", "last_reviewed_at", "next_review_date", "metadata", "rendering_options", "signature_settings", "created_by", "updated_by", "approved_by", "updated_at", "created_at") values (684, asperiores quae cupiditate, beatae-quia-dolores-rem-necessitatibus-sint-voluptatem, ?, custom, ullam, ["nostrum","numquam","illum"], inactive, 1.0, ?, 0, ?, ?, ["client_id","start_date","end_date"], ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, fixed, ?, ?, ?, ?, ?, ?, 75.26, ?, ?, ?, ?, ?, ?, 0, ?, ?, 0, ?, ?, ?, ?, ?, ?, 124, ?, ?, 2025-10-05 07:52:42, 2025-10-05 07:52:42) returning "id")

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:347

Caused by
PDOException: SQLSTATE[23514]: Check violation: 7 ERROR:  new row for relation "contract_templates" violates check constraint "contract_templates_status_check"
DETAIL:  Failing row contains (10, 684, asperiores quae cupiditate, beatae-quia-dolores-rem-necessitatibus-sint-voluptatem, null, custom, ullam, ["nostrum","numquam","illum"], inactive, 1.0, null, f, null, null, ["client_id","start_date","end_date"], fixed, null, null, null, null, null, null, null, 75.26, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 0, null, null, f, null, null, null, null, null, null, 124, null, null, 2025-10-05 07:52:42, 2025-10-05 07:52:42, null, null).

/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:411
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:811
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:778
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:397
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Connection.php:384
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Processors/PostgresProcessor.php:24
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Query/Builder.php:3853
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Builder.php:2235
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1436
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1401
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:1240
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:370
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php:271
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:365
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:321
/opt/nestogy/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Factories/Factory.php:315
/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:347

--

There were 2 failures:

1) Tests\Unit\Services\ContractGenerationServiceTest::test_contract_generation_with_multiple_templates
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'managed_services'
+'compliance'

/opt/nestogy/tests/Unit/Services/ContractGenerationServiceTest.php:308

2) Tests\Unit\Services\ContractGenerationServiceTest::test_regenerate_contract_handles_signed_contracts
Failed asserting that exception of type "Exception" is thrown.

ERRORS!
Tests: 891, Assertions: 1506, Errors: 8, Failures: 2.

Generating code coverage report in Clover XML format ... PHP Fatal error:  Allowed memory size of 536870912 bytes exhausted (tried to allocate 4198400 bytes) in /opt/nestogy/vendor/phpunit/php-code-coverage/src/Report/Clover.php on line 217
